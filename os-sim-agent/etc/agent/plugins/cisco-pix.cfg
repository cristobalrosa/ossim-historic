;; cisco-pix
;; plugin_id: 1514
;; 
;; $Id: cisco-pix.cfg,v 1.3 2007/12/12 10:24:18 juanmals Exp $
;;
;; TODO: test plugin with the following sample logs:
;;       http://www.ossec.net/wiki/index.php/Cisco_PIX
;;

[DEFAULT]
plugin_id=1514

[config]
type=detector
enable=yes

source=log
location=/var/log/syslog
create_file=false

process=
start=no
stop=no
startup=
shutdown=

[cisco-pix-rule1]
# May 20 2006 01:00:00 saravana: %PIX-6-302013: 
# Built outbound TCP connection 31174132 
# for outside:212.37.223.35/80 (212.37.223.35/80) 
# to inside:192.168.1.1/52648 (64.211.150.166/54508)
#
# Mar 29 2004 09:56:03: %PIX-6-106015:
# Deny TCP (no connection)
# from 192.168.0.2/2796 to 192.168.80.1/1719
# flags SYN ACK on interface inside
#
# Jun 26 14:49:15 ossim-devel: %PIX-6-302016: 
# Teardown UDP connection 1042068 
# for outside:192.168.20.45/53 to inside:192.168.20.208/37989 
# duration 0:02:10 bytes 185
event_type=event
regexp=(?P<date>\SYSLOG_DATE)\s*(?P<sensor>[^:]*):.*?(PIX|ASA)-\d-(?P<sid>\d+):.*?(from|src|for inside|for outside|src inside|src outside).*?(?P<src>\IPv4)(\/(?P<sport>\d+))?.*?(dst|to inside|to outside|dst inside|dst outside).*?(?P<dst>\IPv4)(\/(?P<dport>\d+))?
date={$date}
sensor={$sensor}
plugin_sid={$sid}
src_ip={$src}
src_port={$sport}
dst_ip={$dst}
dst_port={$dport}


[cisco-pix-rule2]
# Nov 23 08:06:28 192.168.0.1 Nov 23 2007 08:08:37: %PIX-5-710005: UDP request
# discarded from 192.195.10.21/6809 to laboratorio:192.195.10.255/6809 
# 
# Nov 23 07:07:49 192.168.0.1 Nov 23 2007 07:09:59: %PIX-5-106100: access-list
# Windows_access_in denied tcp Windows-Dev2/192.116.200.40(3418) ->
# dmz/192.4.125(168) hit-cnt 1 first hit [0x90a9a2f9, 0x0]
#
# Nov 23 08:27:25 192.168.0.1 Nov 23 2007 08:29:34: %PIX-4-313005: No
# matching connection for ICMP error message: icmp src outside:192.12.11.254
# dst serversdmz:192.1.4.8 (type 3, code 1) on outside interface.  Original IP
# payload: tcp src 192.1.4.8/40934 dst 192.12.11.254/6000.
#
# Nov 23 11:09:33 192.168.0.1 Nov 23 2007 11:11:42: %PIX-4-106023: Deny tcp src
# outside:192.192.20.20/80 dst inside:192.4.1.6/2319 by access-group
# "outside_access_in" [0x0, 0x0] 

event_type=event
regexp="\SYSLOG_DATE\s+(?P<sensor>[^\s]*)\s+(?P<date>\SYSLOG_WY_DATE):.*?(PIX|ASA)-\d-(?P<sid>\d+):.*?(?P<src>\IPv4)(\/(?P<sport>\d+))?.*?(?P<dst>\IPv4)(\/(?P<dport>\d+))?"
date={normalize_date($date)}
sensor={resolv($sensor)}
plugin_sid={$sid}
src_ip={$src}
src_port={$sport}
dst_ip={$dst}
dst_port={$dport}
