;; pam_unix
;; type: detector
;; plugin_id: 4004
;;
;; $Id: pam_unix.cfg,v 1.2 2007/05/30 18:06:07 alberto_r Exp $

[DEFAULT]
plugin_id=4004

[config]
type=detector
enable=yes

source=log
location=/var/log/auth.log
create_file=false

process=
start=no
stop=no
startup=
shutdown=

[pam_unix-authentication-successful]
# Aug 14 17:32:19 localhost su(pam_unix)[17944]: session opened for user root 
# by (uid=123)
event_type=event
regexp=(\S+\s+\d+\s+\d\d:\d\d:\d\d)\s+(\S+)\s+.*?\(pam_unix\).*? session opened for user (\S+) by (\S*)\(uid=(\d*)\)
plugin_sid=1
date={normalize_date($1)}
username={$3}
data=uid: {$5}
description=User {$3} authenticated successfuly
src_ip={resolv($2)}

[pam_unix-authentication-failure]
# Feb  7 15:31:41 golgotha login[3867]: (pam_unix) authentication
# failure; logname=LOGIN uid=0 euid=0 tty=tty1 ruser= rhost=
# user=dgil
# Nov 14 12:42:35 localhost login[2912]: (pam_unix) authentication failure;
# logname= uid=0 euid=0 tty=tty2 ruser= rhost=  user=dgil
event_type=event
regexp=(\S+\s+\d+\s+\d\d:\d\d:\d\d)\s+.*?\(pam_unix\).*? authentication failure; logname=([^ ]*)[ ]*uid=([^ ]*)[ ]*euid=.* tty=([^ ]*)[ ]*ruser=([^ ]*)[ ]*rhost=([^ ]*)[ ]*user=([^ ]*)
plugin_sid=2
date={normalize_date($1)}
filename={$2}
username={$7}
src_ip={$6}
#description=User {$5} tried to authenticate as {$6} and failed
data=uid: {$3}, tty: {$4}


[pam_unix-2-more-authentication-failures]
# Feb  8 10:51:34 golgotha sshd[29755]: (pam_unix) 2 more
# authentication failures; logname= uid=0 euid=0 tty=ssh ruser=
# rhost=192.168.6.69  user=dgil
event_type=event
regexp=(\S+\s+\d+\s+\d\d:\d\d:\d\d)\s+.*?\(pam_unix\).*? 2 more authentication failures; logname=([^ ]*)[ ]*uid=([^ ]*)[ ]*euid=.* tty=([^ ]*)[ ]*ruser=([^ ]*)[ ]*rhost=([^ ]*)[ ]*user=([^ ]*)
plugin_sid=3
date={normalize_date($1)}
filename={$2}
username={$7}
src_ip={$6}
#description=User {$5} tried to authenticate (more than 2 times) as {$6} and failed
data=uid: {$3}, tty: {$4}

