AC_PREREQ(2.52)
AC_INIT(src/main.c)

AM_CONFIG_HEADER(config.h)

OS_SIM_MAJOR_VERSION=0
OS_SIM_MINOR_VERSION=9
OS_SIM_MICRO_VERSION=9
OS_SIM_VERSION=$OS_SIM_MAJOR_VERSION.$OS_SIM_MINOR_VERSION.$OS_SIM_MICRO_VERSION

AC_SUBST(OS_SIM_MAJOR_VERSION)
AC_SUBST(OS_SIM_MINOR_VERSION)
AC_SUBST(OS_SIM_MICRO_VERSION)
AC_SUBST(OS_SIM_VERSION)

AM_INIT_AUTOMAKE(os-sim, $OS_SIM_VERSION)

AM_MAINTAINER_MODE

AC_ISC_POSIX
AC_PROG_CC
AC_PROG_CXX
AC_STDC_HEADERS
#AM_PROG_LIBTOOL
AC_PROG_INSTALL

AC_CANONICAL_HOST

case "$host" in
    *darwin*)
    LDFLAGS="${LDFLAGS} -bind_at_load"
    ;;
esac

# Check for structures
AC_CHECK_MEMBER([struct sockaddr.sa_len],
                AC_DEFINE(HAVE_SOCKADDR_SA_LEN, 1,
                  [Define if struct sockaddr has sa_len field]),,
                [#include <sys/types.h>
                 #include <sys/socket.h>])

AC_MSG_CHECKING([for struct sockaddr_storage])
AC_TRY_COMPILE([ #include <sys/types.h>
#include <sys/socket.h>], [struct sockaddr_storage s; s],
  have_sockaddr_storage=yes, have_sockaddr_storage=no)
if test "$have_sockaddr_storage" = "yes" ; then
  AC_DEFINE(HAVE_SOCKADDR_STORAGE,1,[Whether you have struct sockaddr_storage])
  AC_MSG_RESULT(yes)
else
  AC_MSG_RESULT(no)
fi

# Check for IPv6 support
AC_MSG_CHECKING([for IPv6 availability])
AC_TRY_LINK([ #include <sys/types.h>
#include <sys/socket.h>
#include <netinet/in.h>], [struct sockaddr_in6 s; struct in6_addr t=in6addr_any; int i=AF_INET6; s; t.s6_addr[0] = 0;],
  [
    AC_DEFINE(HAVE_IPV6, 1, [Define if IPv6 is potentially available])
    AC_MSG_RESULT(yes)
  ],
  [
    AC_MSG_RESULT(no)
  ]
)

PKG_CHECK_MODULES(DEPS, glib-2.0 >= 2.2 gobject-2.0 >= 2.2 gthread-2.0 >= 2.2 gnet-2.0 > 2.0 libxml-2.0 openssl >= 0.9.7)


AC_ARG_WITH(libgda,
[  --with-libgda=<directory>         path for libgda libs and includes])

if test "x$withval" != "x"; then
	libgda=$withval
	AC_MSG_CHECKING(for libgda files)
	LIBGDA_CFLAGS="-I${libgda}/include/libgda-1.2"
	LIBGDA_LIBS="-L${libgda}/lib -lgda-2"
	# XXX check for dirs/files
    AC_MSG_RESULT($libgda)
else
    PKG_CHECK_MODULES(LIBGDA, libgda >= 1.0, ,
        [
        AC_MSG_RESULT(no)
        echo $LIBGDA_PKG_ERRORS
        exit 1
        ])
fi

AC_SUBST(LIBGDA_CFLAGS)
AC_SUBST(LIBGDA_LIBS)
AC_SUBST(DEPS_CFLAGS)
AC_SUBST(DEPS_LIBS)

AC_OUTPUT([
Makefile
src/Makefile
etc/Makefile
etc/server/Makefile
etc/framework/Makefile
etc/cron.d/Makefile
etc/cron.daily/Makefile
etc/init.d/Makefile
etc/logrotate.d/Makefile
db/Makefile
db/plugins/Makefile
pixmaps/Makefile
include/Makefile
include/classes/Makefile
include/upgrades/Makefile
include/panel/Makefile
include/panel/plugins/Makefile
include/xajax/Makefile
www/Makefile
www/action/Makefile
www/business_processes/Makefile
www/conf/Makefile
www/control_panel/Makefile
www/directives/Makefile
www/editor/Makefile
www/event_viewer/Makefile
www/feed/Makefile
www/hids/Makefile
www/host/Makefile
www/incidents/Makefile
www/maps/Makefile
www/nagios/Makefile
www/net/Makefile
www/ntop/Makefile
www/panel/Makefile
www/pixmaps/Makefile
www/pixmaps/os/Makefile
www/pixmaps/panel/Makefile
www/pixmaps/top/Makefile
www/pixmaps/therm/Makefile
www/policy/Makefile
www/port/Makefile
www/report/Makefile
www/report/graphs/Makefile
www/report/jgraphs/Makefile
www/riskmeter/Makefile
www/rrd_conf/Makefile
www/scan/Makefile
www/sensor/Makefile
www/server/Makefile
www/session/Makefile
www/setup/Makefile
www/signature/Makefile
www/style/Makefile
www/vulnmeter/Makefile
www/backup/Makefile
www/java/Makefile
www/java/images/Makefile
www/js/Makefile
www/js/rico/Makefile
www/js/scriptaculous/Makefile
www/js/mattkruse/Makefile
www/js/OpenLayers/img/Makefile
www/js/OpenLayers/Makefile
www/netscan/Makefile
www/response/Makefile
www/upgrade/Makefile
www/userlog/Makefile
scripts/Makefile
scripts/correlation/Makefile
scripts/extract_nessus/Makefile
scripts/extract_osvdb/Makefile
scripts/extract_osvdb/OS/Makefile
contrib/Makefile
contrib/fonts/Makefile
contrib/ntop/Makefile
contrib/mrtg/Makefile
contrib/arpwatch/Makefile
contrib/acid/Makefile
contrib/base/Makefile
contrib/debian/Makefile
contrib/debian/agent/Makefile
contrib/debian/framework/Makefile
contrib/debian/httpd/Makefile
contrib/debian/init.d/Makefile
contrib/fedora/Makefile
contrib/fedora/init.d/Makefile
contrib/fedora/sysconfig/Makefile
contrib/oinkmaster/Makefile
contrib/osvdb/Makefile
contrib/spade/Makefile
contrib/snort/Makefile
contrib/patches/Makefile
contrib/py-rrdtool/Makefile
contrib/barnyard/Makefile
locale/zh_TW/LC_MESSAGES/Makefile
locale/zh_TW/Makefile
locale/es/LC_MESSAGES/Makefile
locale/es/Makefile
locale/fr/LC_MESSAGES/Makefile
locale/fr/Makefile
locale/zh_CN/LC_MESSAGES/Makefile
locale/zh_CN/Makefile
locale/Makefile
locale/ru/LC_MESSAGES/Makefile
locale/ru/Makefile
locale/en/LC_MESSAGES/Makefile
locale/en/Makefile
locale/de/LC_MESSAGES/Makefile
locale/de/Makefile
locale/ja/LC_MESSAGES/Makefile
locale/ja/Makefile
locale/pt_BR/LC_MESSAGES/Makefile
locale/pt_BR/Makefile
])
