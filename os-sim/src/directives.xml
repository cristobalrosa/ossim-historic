<?xml version="1.0"?>

<directives>

  <directive id="1" name="Suspicious web access" priority="2">
    <rule type="detector" name="Rare but open dest http port used" reliability="1" time_out="60" occurrence="3" from="ANY" to="ANY" port_from="ANY" port_to="80,8000,8080" plugin_id="1104" plugin_sid="101">
      <rules>
        <rule type="detector" name="Suspicious /cgi-bin/ access " priority="1" reliability="1" time_out="30" occurrence="1" from="1:SRC_IP" to="1:DST_IP" port_from="1:SRC_PORT" port_to="1:DST_PORT" plugin_id="1001" plugin_sid="1668">
          <rules>
            <rule type="detector" name="Cgi-bin response" reliability="5" time_out="10" occurrence="1" from="2:DST_IP" to="2:SRC_IP" port_from="2:DST_PORT" port_to="2:SRC_PORT" plugin_id="1001" plugin_sid="1666"/>
            <rule type="detector" name="Directory listing" reliability="5" time_out="10" occurrence="1" from="2:DST_IP" to="2:SRC_IP" port_from="2:DST_PORT" port_to="2:SRC_PORT" plugin_id="1001" plugin_sid="1292"/>
          </rules>
        </rule>
      </rules>
    </rule>
  </directive>

<!-- For a more complex dcom directive please read the correlation paper at http://www.ossim.net -->
  <directive id="2" name="Successful DCOM exploit" priority="9">
    <rule type="detector" name="Dcom exploit shellcode (2192)" priority="1" reliability="5" occurrence="1" from="ANY" to="ANY" port_from="ANY" port_to="135,445" plugin_id="1001" plugin_sid="2192">
      <rules>
        <rule type="detector" name="Rare dest port after shellcode" reliability="5" time_out="60" occurrence="1" from="1:SRC_IP" to="1:DST_IP" port_from="ANY" port_to="ANY" plugin_id="1104" plugin_sid="1">
          <rules>
            <rule type="detector" name="Windows cmd.exe attack response" priority="1" reliability="6" time_out="60" occurrence="1" from="1:DST_IP" to="1:SRC_IP" port_from="2:DST_PORT" port_to="2:SRC_PORT" plugin_id="1001" plugin_sid="2123">
        <rules>
            <rule type="detector" name="Strange connections (DCOM)" reliability="7" time_out="300" occurrence="1" from="1:DST_IP" to="ANY" port_from="ANY" port_to="ANY" plugin_id="1104" plugin_sid="6"/>
            <rule type="detector" name="Strange connections (DCOM)" reliability="7" time_out="300" occurrence="1" from="1:DST_IP" to="ANY" port_from="ANY" port_to="ANY" plugin_id="1104" plugin_sid="3"/>
            <rule type="detector" name="Strange connections (DCOM)" reliability="7" time_out="300" occurrence="1" from="1:DST_IP" to="ANY" port_from="ANY" port_to="ANY" plugin_id="1104" plugin_sid="1"/>
          </rules>
         </rule>
       </rules>
        </rule>
      </rules>
    </rule>
  </directive>

<!-- this directive shows how to use the session monitor correlation, insert any other ip address if you want to test -->
<directive id="3" name="Test session monitor" priority="3">
    <rule type="detector" name="Rare dest port" reliability="5" occurrence="1" from="192.168.1.97" to="ANY" port_from="ANY" port_to="ANY" plugin_id="1104" plugin_sid="1">
        <rules>
            <rule type="monitor" name="Established session against odd port" reliability="5" from="1:SRC_IP" to="1:DST_IP" port_from="1:SRC_PORT" port_to="1:DST_PORT" plugin_id="2005" plugin_sid="248" condition="ge" value="10" interval="5" time_out="60" absolute="true"/>
        </rules>
    </rule>
</directive>

<!-- this directive is used to show how to use the C & A level monitor. Just insert any other ip address -->
<directive id="4" name="Test C or A" priority="3">
    <rule type="detector" name="Rare dest port" reliability="1" time_out="10" occurrence="1" from="192.168.1.97" to="ANY" port_from="ANY" port_to="ANY" plugin_id="1104" plugin_sid="1">

        <rules>
            <rule type="monitor" name="Ask C" reliability="5" from="1:SRC_IP" plugin_id="2001" plugin_sid="1" condition="ge" value="1" interval="10" time_out="60" absolute="true"/>
        </rules>
    </rule>
</directive>

<!-- the directive logic used within the next 3 directives has to be greatly improved but they can be used already -->
<directive id="5" name="Too many threshold exceedings" priority="2">
        <rule type="detector" name="Too many threshold exceedings" reliability="2" time_out="300" occurrence="10" from="ANY" to="ANY" port_from="ANY" port_to="ANY" plugin_id="1507" plugin_sid="ANY">
                <rules>
        <rule type="detector" name="Too many threshold exceedings" reliability="5" time_out="60" occurrence="1" from="1:SRC_IP" to="ANY" port_from="ANY" port_to="ANY" plugin_id="1507" plugin_sid="ANY"/>
                </rules>
        </rule>
</directive>

<directive id="6" name="Too many anomalies" priority="2">
        <rule type="detector" name="Too many anomalies" reliability="2" time_out="300" occurrence="10" from="ANY" to="ANY" port_from="ANY" port_to="ANY" plugin_id="1508" plugin_sid="ANY">
                <rules>
        <rule type="detector" name="Too many anomalies" reliability="5" time_out="60" occurrence="1" from="1:SRC_IP" to="ANY" port_from="ANY" port_to="ANY" plugin_id="1508" plugin_sid="ANY"/>
                </rules>
        </rule>
</directive>

<directive id="7" name="Possible worm" priority="2">
        <rule type="detector" name="Possible worm, connection anomalies" reliability="2" time_out="300" occurrence="10" from="ANY" to="ANY" port_from="ANY" port_to="ANY" plugin_id="1104" plugin_sid="1">
                <rules>
        <rule type="detector" name="Possible worm, connection anomalies" reliability="5" time_out="60" occurrence="1" from="1:SRC_IP" to="ANY" port_from="ANY" port_to="1:DST_PORT" plugin_id="1104" plugin_sid="1"/>
                </rules>
        </rule>
</directive>

</directives>
