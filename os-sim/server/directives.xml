<?xml version="1.0"?>

<directives>

  <directive id="1" name="Suspicious web access" time_out="10">
    <rule name="1" from="ANY" to="ANY" port_from="ANY" port_to="80,443,8080" plugin="104" tplugin="6">
      <rules>
        <rule name="2a" from="1:SRC_IP" to="1:DST_IP" port_from="1:SRC_PORT" port_to="1:DST_PORT" plugin="1" tplugin="1668">
          <rules>
            <rule name="3a" from="2:DST_IP" to="2:SRC_IP" port_from="2:DST_PORT" port_to="2:SRC_PORT" plugin="1" tplugin="1666"/>
            <rule name="3b" from="2:DST_IP" to="2:SRC_IP" port_from="2:DST_PORT" port_to="2:SRC_PORT" plugin="1" tplugin="1292"/>
          </rules>
        </rule>
        <rule name="2b" from="1:SRC_IP" to="1:DST_IP" port_from="1:SRC_PORT" port_to="1:DST_PORT" plugin="1" tplugin="1125"/>
      </rules>
      <actions>
        <action type="timeout" do="mailto" to="fot@ipsoluciones.com" body="Rule Time Out"/>
        <action type="matched" do="database"/>
        <action type="matched" do="mailto" to="fot@ipsoluciones.com" body="Rule Matched"/>
      </actions>
    </rule>
    <actions>
      <action type="timeout" do="mailto" to="fot@ipsoluciones.com" subject="Directive Time Out" body="Directive time out"/>
      <action type="matched" do="database"/>
      <action type="matched" do="mailto" to="fot@ipsoluciones.com" subject="Directive Matched" body="Directive matched"/>
    </actions>
  </directive>

  <directive id="2" name="Successful DCOM exploit" time_out="300">
    <rule name="Strange 135/tcp connection" from="ANY" to="ANY" port_from="ANY" port_to="135" plugin="104" tplugin="1">
      <rules>
        <rule name="Dcom-exit-thread default exploit" from="1:SRC_IP" to="1:DST_IP" port_from="ANY" port_to="666" plugin="104" tplugin="1">
          <rules>
            <rule name="Dcom exploit shellcode" from="1:SRC_IP" to="1:DST_IP" port_from="1:SRC_PORT" port_to="1:DST_PORT" plugin="1" tplugin="6666"/>
            <rule name="Dcom exploit shellcode" from="1:SRC_IP" to="1:DST_IP" port_from="1:SRC_PORT" port_to="1:DST_PORT" plugin="1" tplugin="2192"/>
            <rule name="Strange connections (DCOM?)" from="1:DST_IP" to="ANY" port_from="ANY" port_to="ANY" plugin="104" tplugin="1"/>
            <rule name="Strange connections (DCOM?)" from="1:DST_IP" to="ANY" port_from="ANY" port_to="ANY" plugin="104" tplugin="3"/>
            <rule name="Strange connections (DCOM?)" from="1:DST_IP" to="ANY" port_from="ANY" port_to="ANY" plugin="104" tplugin="4"/>
            <rule name="Strange connections (DCOM?)" from="1:DST_IP" to="ANY" port_from="ANY" port_to="ANY" plugin="104" tplugin="6"/>
          </rules>
        </rule>
        <rule name="Strange connection after 135/tcp" from="1:SRC_IP" to="1:DST_IP" port_from="ANY" port_to="ANY" plugin="104" tplugin="1">
          <rules>
            <rule name="Dcom exploit shellcode" from="1:SRC_IP" to="1:DST_IP" port_from="1:SRC_PORT" port_to="1:DST_PORT" plugin="1" tplugin="6666"/>
            <rule name="Dcom exploit shellcode" from="1:SRC_IP" to="1:DST_IP" port_from="1:SRC_PORT" port_to="1:DST_PORT" plugin="1" tplugin="2192"/>
            <rule name="Strange connections (DCOM?)" from="1:DST_IP" to="ANY" port_from="ANY" port_to="ANY" plugin="104" tplugin="1"/>
            <rule name="Strange connections (DCOM?)" from="1:DST_IP" to="ANY" port_from="ANY" port_to="ANY" plugin="104" tplugin="3"/>
            <rule name="Strange connections (DCOM?)" from="1:DST_IP" to="ANY" port_from="ANY" port_to="ANY" plugin="104" tplugin="4"/>
            <rule name="Strange connections (DCOM?)" from="1:DST_IP" to="ANY" port_from="ANY" port_to="ANY" plugin="104" tplugin="6"/>
          </rules>
        </rule>
        <rule name="Dcom exploit shellcode" from="1:SRC_IP" to="1:DST_IP" port_from="1:SRC_PORT" port_to="1:DST_PORT" plugin="1" tplugin="6666"/>
        <rule name="Dcom exploit shellcode" from="1:SRC_IP" to="1:DST_IP" port_from="1:SRC_PORT" port_to="1:DST_PORT" plugin="1" tplugin="2192"/>
      </rules>
    </rule>
  </directive>

</directives>
