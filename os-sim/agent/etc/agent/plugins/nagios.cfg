;; nagios
;; type: detector
;; plugin_id: 1525
;;
;; $Id: nagios.cfg,v 1.7 2009/02/16 17:12:23 jvblanco Exp $
;;


[DEFAULT]
plugin_id=1525

[config]
type=detector
enable=yes

process=nagios3
start=yes
stop=yes
startup=/etc/init.d/%(process)s start
shutdown=/etc/init.d/%(process)s stop

source=log
location=/var/log/%(process)s/nagios.log

[translation]
DOWN;HARD=1
UP;HARD=2
UNREACHABLE;HARD=3
DOWN;SOFT=4
UP;SOFT=5
UNREACHABLE;SOFT=6
CRITICAL;HARD=7
OK;HARD=8
UNKNOWN;HARD=9
WARNING;HARD=10
CRITICAL;SOFT=11
OK;SOFT=12
UNKNOWN;SOFT=13
WARNING;SOFT=14


## TODO: unify host and service rules in one
## \[(\d+)\] ([^:]+): ([^;]+)\;(?:([^;]+)\;)?((CRITICAL|WARNING|OK|DOWN|UP)\;(SOFT|HARD))\;\d+\;(.+)
##

[nagios-host-alert]
# [1164180397] HOST ALERT: golgotha;DOWN;SOFT;2;CRITICAL - Host Unreachable
# (192.168.6.64)
event_type=event
regexp=\[(\d+)\] HOST ALERT: ([\w\-]+)\;((DOWN|UP)\;(HARD|SOFT))\;\d+\;(.+)
date={normalize_date($1)}
src_ip={resolv($2)}
plugin_sid={translate($3)}
data={$6}
userdata1=host_availability: {$4}


[nagios-service-alert]
# [1164179890] SERVICE ALERT: golgotha;PING;OK;SOFT;2;PING OK - 
# Packet loss = 0%, RTA = 14.15 ms
event_type=event
regexp=\[(\d+)\] SERVICE ALERT: ([^;]+)\;([^;]+)\;((CRITICAL|WARNING|OK)\;(SOFT|HARD))\;\d+\;(.+)
date={normalize_date($1)}
src_ip={resolv($2)}
plugin_sid={translate($4)}
data={$7}
userdata1=service_availability: {$5}

[nagios-host-alert-syslog]
#Jan 18 10:46:36 172.23.120.1 nagios: GLOBAL HOST EVENT HANDLER: 12112;DOWN;HARD;1;alarma_host
event_type=event
regexp=(\S+\s+\S+\s+\S+) (\S+) \S+: ([^:]+): ([^;]+)\;((DOWN|UP)\;(SOFT|HARD))\;\d+\;(.+)
date={normalize_date($1)}
sensor={resolv($2)}
src_ip={resolv($4)}
dst_ip={resolv($4)}
plugin_sid={translate($5)}
data={$4}: {$8}
userdata1=host_availability: {$6}
userdata2={$3}
userdata3={$4}
userdata4={$8}

[nagios-service-alert-syslog]
#Jan 18 10:46:40 172.23.120.1 nagios: GLOBAL SERVICE EVENT HANDLER:
#0561;Comunicaciones;OK;HARD;1;alarma_servicio
event_type=event
regexp=(\S+\s+\S+\s+\S+) (\S+) \S+: ([^:]+): ([^;]+)\;([^;]+)\;((CRITICAL|WARNING|OK)\;(SOFT|HARD))\;\d+\;(.+)
date={normalize_date($1)}
sensor={resolv($2)}
src_ip={resolv($4)}
dst_ip={resolv($4)}
plugin_sid={translate($6)}
data={$5}: {$9}
userdata1=service_availability: {$7}
userdata2={$3}
userdata3={$5}
userdata4={$9}

